//注意：如果您希望修改Edgeless内核形成自己的作品，请访问 https://wiki.edgeless.top/v2/cooperation/permit.html 查看要求

LOGS %WinDir%\System32\Pecmd.%USERNAME%.log

CALL OSInit
//此处开始LOGO
CALL PreShell
CALL LoadShell
CALL PostShell
//此处退出LOGO

//此时启动完成
EXIT

////////////////////////////////////////////////////////////////////////////////////////////////
_SUB OSInit

//启动winpeshl以替换cmd为Shell
IFEX %WinDir%\System32\winpeshl.log,!EXEC %WinDir%\System32\winpeshl.exe

// 加载基础显示驱动
// EXEC =@!%WinDir%\System32\Drvload.exe %WinDir%\inf\basicdisplay.inf %WinDir%\inf\basicrender.inf %WinDir%\inf\c_display.inf %WinDir%\inf\display.inf %WinDir%\inf\displayoverride.inf

//开启小键盘
NUMK 1

_END
////////////////////////////////////////////////////////////////////////////////////////////////
_SUB PreShell

EXEC =!"X:\PEMaterial\Autoruns\PEStartupMain.bat" OSInit

INIT IU,3000

_END
////////////////////////////////////////////////////////////////////////////////////////////////
_SUB LoadShell

//启动ctfmon
IFEX %WinDir%\System32\ctfmon.exe, EXEC PECMD.exe EXEC -su %WinDir%\System32\ctfmon.exe

EXEC =!"X:\PEMaterial\Autoruns\PEStartupMain.bat" BeforeShell

//启动explorer和WinXShell修复守护进程
SHEL explorer.exe
EXEC !%ProgramFiles%\WinXShell\WinXShell.exe -regist -daemon

_END
////////////////////////////////////////////////////////////////////////////////////////////////
_SUB PostShell

//启动任务栏
EXEC =%ProgramFiles%\WinXShell\WinXShell.exe -luacode Taskbar:WaitForReady()

EXEC !"X:\PEMaterial\Autoruns\PEStartupMain.bat" PostShell

_END
////////////////////////////////////////////////////////////////////////////////////////////////
